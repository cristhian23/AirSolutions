<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ver item - AirSolutions</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/site.css" rel="stylesheet">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
      <a class="navbar-brand" href="/">AirSolutions</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="../clients/">Clientes</a></li>
          <li class="nav-item"><a class="nav-link active" href="index.html">Catálogo</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-4">
    <div class="d-flex align-items-center gap-2 mb-4 flex-wrap">
      <a class="btn btn-outline-secondary btn-sm" href="index.html">← Lista</a>
      <h1 class="h2 mb-0">Detalle del item</h1>
      <div class="ms-auto">
        <a class="btn btn-primary btn-sm" id="linkEdit">Editar</a>
      </div>
    </div>

    <div id="alertPlaceholder"></div>
    <div id="content" class="card">
      <div class="card-body">
        <div class="text-center text-muted py-5">Cargando...</div>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const API = '/api/catalogitems';
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const content = document.getElementById('content');
    const alertPlaceholder = document.getElementById('alertPlaceholder');

    if (!id) { location.href = 'index.html'; throw 'no id'; }

    function showAlert(msg, type) {
      alertPlaceholder.innerHTML = '<div class="alert alert-' + type + '">' + msg + '</div>';
    }

    function formatDate(d) {
      if (!d) return '-';
      const dt = new Date(d);
      return isNaN(dt.getTime()) ? '-' : dt.toLocaleString('es');
    }

    const typeNames = { Service: 'Servicio', Product: 'Producto', Material: 'Material', Other: 'Otro' };

    fetch(API + '/' + id)
      .then(r => { if (!r.ok) throw new Error(); return r.json(); })
      .then(data => {
        document.getElementById('linkEdit').href = 'edit.html?id=' + data.id;
        content.querySelector('.card-body').innerHTML =
          '<table class="table table-borderless mb-0">' +
          '<tr><th class="text-muted" style="width:12rem">Id</th><td>' + data.id + '</td></tr>' +
          '<tr><th class="text-muted">Nombre</th><td>' + (data.name || '-') + '</td></tr>' +
          '<tr><th class="text-muted">Tipo</th><td>' + (typeNames[data.itemType] || data.itemType || '-') + '</td></tr>' +
          (data.nivel ? '<tr><th class="text-muted">Nivel</th><td>' + data.nivel + '</td></tr>' : '') +
          '<tr><th class="text-muted">SKU</th><td>' + (data.sku || '-') + '</td></tr>' +
          '<tr><th class="text-muted">Descripción</th><td>' + (data.description || '-') + '</td></tr>' +
          '<tr><th class="text-muted">Unidad</th><td>' + (data.unit || '-') + '</td></tr>' +
          '<tr><th class="text-muted">Precio base</th><td>' + (data.basePrice != null ? '$' + parseFloat(data.basePrice).toFixed(2) : '-') + '</td></tr>' +
          '<tr><th class="text-muted">Costo</th><td>' + (data.cost != null ? '$' + parseFloat(data.cost).toFixed(2) : '-') + '</td></tr>' +
          '<tr><th class="text-muted">Gravable</th><td>' + (data.isTaxable ? 'Sí' : 'No') + '</td></tr>' +
          '<tr><th class="text-muted">Activo</th><td>' + (data.isActive ? 'Sí' : 'No') + '</td></tr>' +
          '<tr><th class="text-muted">Creado</th><td>' + formatDate(data.createdAt) + '</td></tr>' +
          '<tr><th class="text-muted">Actualizado</th><td>' + formatDate(data.updatedAt) + '</td></tr>' +
          '</table>';
      })
      .catch(() => {
        content.querySelector('.card-body').innerHTML = '<p class="text-danger mb-0">Item no encontrado.</p>';
      });
  </script>
</body>
</html>
